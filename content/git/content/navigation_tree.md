# Переход по дереву коммитов

В этом разделе мы изучим как перемещатся по дереву коммитов репозитория

## Способы обращения к коммитам

**Деревоподобность** (*анг.* tree-ish) - это что-то что указывает на коммит.

Есть несколько способов сослатся на коммит

* Использования контрольной суммы коммита (SHA-1). Git всегда будет знать какой коммит мы имеем ввиду потому что каждый из этих строк (40 символов) является уникальным. Случайность того что они могут быть не уникальными - является фактически невероятной.
* Указатель `HEAD`, который всегда указывает на коммит, который находится на верху текущего бранча на котором был сделан чекаут.
* Ссылка на бранч - тогда мы будем ссылатся на верхушку данного бранча и это может быть не объязательно бранч с текущим чекаутом.
* Ссылка `tag` - это може способ обращения к коммитам
* Использование одного из вышеперечисленных методов, а затем обращение к предкам этих объектов.
  * Мы сначала даём ссылку на то на чём мы хотим сфокусироватся, а затем мы говорим найти его родителя + знак вставки. Знак вставки идёт сразу после объекта, тоесть он указывает на родителя в дереве - `HEAD^`, `acf87504^`, `master^`.
  * Мы также можем использовать нотацию тильды, тоесть сначала мы указываем ссылку на коммит (объект), затем значок тильды, после чего указываем число поколений на которое мы хотим поднятся - `HEAD~1`, `HEAD~`.
* Мы можем обратится к коммиту предку, если нам нужен родитель родителя тогда мы используем два символа карет - `HEAD^^`, `acf87504^^`, `master^^` или аналоги `HEAD~2`. Как мы видим нотация с тильдой компактнее.

## Обращение к коммитам

Дерево похоже на директории файловой системы и если мы находимся под Unix и хочу получить список файлов в текущей директории мы используем команду `ls -la` позволяет получить список вертикальным списком включая скрытые и системные файлы.

В документации указанно (`git help ls-tree`) что это набор опций, которые мы можем передать.

Чтобы сделать список того что есть в дереве Git можно использовать `HEAD` в качестве параметра.

```bash
git ls-tree HEAD
```

Это те файлы, которые находятся в репозитории от этой точки, тоесть репозиторий видит этот набор файлов. И если я сделаю чекауто из репозитория это будут файлы, которые он мне даст. Это не совсем соответствует тому что есть в рабочей директории, потому что в рабочей директории есть некоторые файлы, для которых мы могли испольовать *.gitignore*.

Можно выбрать информацию из основного бранча - результат будет тот же, потому что `HEAD` указывает на его верхушку и мы получим тот же результат.

```bash
git ls-tree master
```

Мы можем выбрать файлы из определённой директории

```bash
git ls-tree master accets/
```

Чтобы показать состояние файловой системы на момент предыдущего коммита можно воспользоватся следующей командой

```bash
git ls-tree master^
```

В списке мы видим что у нас есть два основных типа файлов:

* `tree` - директория
* `blob` - файлы

Мы можем использовать контрольную сумму определённого объекта (например папки) для того чтобы просмотреть ее состояние

```bash
git ls-tree d564d0bc3dd
```

## Получение больше информации из логов коммитов

Для начала рекомендуется посетить справку Git и посмотреть на справку.

* `git log --oneline` - даёт однострочный список того что находится в файлах с логами, вместо большого списка, который нужно прокручивать. Эта опция сжимает список и даёт часть SHA чтобы мы могли ее использовать чтобы обратится к коммитам, если нужно с ними поработать.
* `git log --oneline -3` - устанавливает лимит коммитов, в данном случае 3
* `git log --since=2016-05-29 --until=2016-05-30` - фильтрация коммитов по времени (об этом уже говорилось ранее). Опции `--after` и `before` будут синонимами
* `git log --since="3 days ago" --until="1 days ago"` - ещё один вариант фильтрации
* `git log --since=3.weeks --until=1.days` - ещё один формат фильтрации по датам
* `git log --author="Vladimir"` - фильтрация по имени автора
* `git log --author="Vladimir Kamuz"` - фильтрация по имени и фамилии автора
* `git log --grep="test"` - использование регулярных выражений для поиска по истории коммитов
* `git log b809da0..3f63219 --oneline` - вывод диапазона коммитов по части их хеша
* `git log b809da0.. --oneline` - вывод диапазона коммитов по части их хеша - от одного и до конца истории
* `git log b809da0.. index.html` - логи коммитов от конкретного коммита (хеш) до конца истории по конкретному файлу
* `git log -p` - (*анг.* patch) показывает изменения, которые были сделанны в файлах по всей истории коммитов
* `git log -p b809da0.. index.html` - какие были сделанны изменения по конкретному файлу в заданом диапазоне
* `git log --stat --summary` - отобразить статистику того что было измененно в каждом файле - это удобно использовать для того, если вы просто хотите узнать о числе изменений и где-именно они были сделанны
* `git log --format=oneline` - аналог `git log --oneline`, в данном случае возвращается полный SHA. Есть варианты формата - `short`, `medium`, `full`, `fuller`, `email`, `raw`
* `git log --graph` - показывает ветвления наших коммитов. Если у нас одна ветка, то он будет линейным, но когда у нас появятся бранчи, тогда картина будет другой
* `git log --oneline --graph --all --decorate` - удобочитаемый лог изменений

## Просмотр коммита

Если мы хотим рассмотреть конкретный коммит, нам нужно его просмотреть и разобратся что было закомиченно - это можно сделать при помощи `git show`. Для того чтобы обратится к конкретному коммиту, нам понадобится SHA.

```bash
git log --oneline
git show b809da0
```

Можно использовать флаги `format` и указатель `HEAD` для того чтобы указывать на ближайшие коммиты

```bash
git show --format=oneline HEAD^^
git show --format=oneline HEAD~4
```

Команда `git show` работает не только с коммитами, но и другими объектами (`blob, `tree`, `tag`), но наиболее часто приходится работать именно с коммитами.

```bash
git ls-tree master
git show d564d0bc3d
```

Перемещение между директориями, просмотр файла с логами и коммитов даст вам возможность понять что именно было закоммичено в репозитории.

## Сравнение коммитов

Когда мы сравниваем два коммита между собой, то на самом деле мы не сравниваем слепки коммитов, только те сделанные изменения, которые сохраненны вместе с этим коммитом - мы сравниваем директории на который ссылается коммит с актуальным состоянием всех файлов репозитория в этот момент времени и это имеет смысл потому что коммит это не только слепок изменений, но он также включает всех предков вплоть до первого отправленного в репозиторий и общая сумма всех этих предков это и есть директория или `tree` в тот момент времени, когда был сделан коммит. Тоесть когда мы сравниваем коммиты мы на самом деле сравниваем две директории и просматриваем что изменилось между этими двумя директориями. Теперь можно сравнить то что было изменно по времени.

Когда мы начнём изучать бранчи - мы можем сравнить два различных бранча, чтобы увидеть что изменилось в этим бранчах. Чтобы сделать сравнение мы используем `diff`. Когда мы использовали его в первый раз, то мы просто использовали `git diff` и тогда эта команда возвращала сделанные между рабочей директорие и буфером, тоесть она показывала нам все изменения, которые могут быть вставленны в буфер и изменения, которые мы не давно сделали, но ещё не сделали но ещё не вставили в буфер. Как только мы отправим их в буфер, то они не будут больше показаны в `git diff`. Нам нужно добавить этой команде другую опцию `--staged` или `--cached` и это синонимы - эти опции показывали нам различия между буфером и репозиторием. Или `HEAD` - тем что указывает `HEAD`.

Вообщем `diff` это очень гибкое средство и оно позволяет нам передать и другие вещи, так что мы можем сравнить не только рабочую директорию, буфер и репозиторий. И если мы передадим SHA, который обращается к коммиту, то нам будет показана разница между рабочей директорией и директорией в тот момент времени, когда был сделан коммит.

```bash
git log --oneline
git diff b809da0
```

Можно смотреть изменения с определённого коммита и до текущего коммита не по всем файлам и директориям, а только по определённому файлу

```bash
git log --oneline
git diff 2f11017 index.html
```

Можно сравнить изменения между двумя коммитами, для этого нужно лишь передать хеши этих коммитов раздёленных точками. Также можно передать только один файл, а не сравнивать всё. Есть множество вариантов указания диапазона сравнения файлов.

```bash
git diff 2f11017..7ef8e40
git diff 2f11017..7ef8e40 .gitignore
git diff 2f11017..HEAD
git diff 2f11017..HEAD^^^
git diff --stat --summary 2f11017..7ef8e40
```

Можно игнорировать изменения с пробелами. Две комманды ниже делаю то же самое.

```bash
git diff -b 2f11017..7ef8e40
git diff --ignore-space-change 2f11017..7ef8e40
```

Игнорировать все пробелы, тоесть любые изменения, которые можно сделать с пробелами.

```bash
git diff -w 2f11017..7ef8e40
git diff --ignore-all-space 2f11017..7ef8e40
```