# Игнорирование файлов

Как только мы добавляем новый файл в репозиторий, Git сразу же добавляет их к списку не отслеживаемых файлов. Но что если в нашем репозитории есть какие-то временные файлы (например конфигурационные файлы различных IDE), которые нам не важны или файл с логами, который вечно меняется, тогда Git будет нас постоянно заставлять коммитить изменения в репозиторий. Вместо этого у нас должен быть способ сказать Git чтобы он просто игнорировал данные файлы.

Чтобы сказать какие именно файлы он должен игнорировать нам нужно создать файл *.gitignore* в корне рабочей директории. В этом файле будет содержатся набор правил для Git, которые будут определять какие файлы нужно использовать для коммитов, а какие файлы должны быть проигнорированны. Эти файлы могут быть очень простые, например список файлов - один на строку. Также можно использовать базовые регулярные выражения.

Файл *.gitignore* всегда включается в репозиторий и коммитится, чтобы другие учасники проекта также могли внести в него правки.

## Категории игнорированных файлов

Есть несколько категорий файлов, которые вы возможно захотите внести в файл *.gitignore*

* Скомпилированный исходный код - компиляцию лучше делать после того как вы получили исходный код из репозитория
* Архивы - данные из архивов как правило нужно разрархивировать
* Логи и базы данных - эти файлы часто меняются
* Файлы сгенерированные операционной системой - это файлы, которые не имеют ничего общего с нашим проектом
* Загруженные пользователем файлы - сюда могут относится различные PDF файлы, изображения, видео
* Никогда не добавляйте в репозиторий содержимое рабочих папок - *node_modules*, *app/bower_components*, *dist*

Правила синтаксиса

* Одна строчка - одно правило
* Пустые строки игнорируются
* Комментарии доступны через решётку(`#`) в начале строки
* `/` - символ слеш в начале строки указывает, что правило применяется только к файлам и папкам, которые располагаются в той же папке, что и сам файл *.gitignore*
* `*` - звёздочка заменяет любое количество символов(ноль или больше)
* `?` - знак вопроса заменяет от нуля до одного символа. Можно размещать в любом месте правила
* `**` - две звёздочки, используются для указания любого количества поддиректорий (подробнее ниже в примерах)
* `!` - восклицательный знак в начале строки означает инвертирование правила, необходим для указания исключений из правил игнорировани
* `\` - обратный слэш используется для экранирования спецсимволов, например, чтобы игнорировать файл с именем `!readme!.txt`, нужно написать такое правило: `\!readme!.txt`
* Для игнорирования всей директории, правило должно оканчиваться на слэш `/`, в противном случае правило считается именем файла.

Примеры файла *.gitignore*

Игнорировать все файлы и директории, включая поддиректории и файлы в них

```bash
*
```

Игнорирование по типу файла. Будут игнорироваться в абсолютно всех директориях. Например */files/data.zip*, */server.log*, */uploads/users/data/info.xls*

```bash
*.zip
*.log
*.pdf
*.xls
```

Игнорирование файла во всех директориях. Например */params/db/config.php*, */config.php*

```bash
config.php
```

Игнорирование конкретного файла только в корне проекта - корнём считается расположение файла *.gitignore*. Например не будет проигнорирован файл */db/config.php*

```bash
/config.php
```

Игнорирование конкретного файла только в указанной директории. Например не будет проигнорирован файл */prod/params/config.php*

```bash
/params/config.php
```

Игнорирование всех файлов и папок только в конкретной директории, включая поддиректории и файлы в них. Например */images/user.jpg*, */images/company/logo.png*. Не будут проигнорированы файлы и папки */prod/images/user.jpg*

```bash
/images/*
```

Игнорирование всех файлов и папок в любых директориях с указанным именем. Например */images/user.jpg*, */core/images/user.jpg*

```bash
images/*
```

Игнорирование всех html-файлов в одной конкретной директории (не включая поддиректории). Например */private/index.html*. Не будут проигнорированы файлы в */private/ivan/index.html*

```bash
/private/*.html
```

Игнорирование всех html-файлов в конкретной директории включая поддиректории. например */private/info.html*, */private/users/ivan/info.html*.

```bash
/private/**/*.html
```

Игнорирование всех файлов и папок внутри директории */secret*, за исключением файла */secret/free.txt*, он не будет проигнорирован

```bash
/secret/*
!/secret/free.txt
```

Игнорирование файла с именем, содержащим спецсимволы. Например *!readme!.txt*

```bash
\!readme!.txt
```

Игнорирование всех JPG и JPEG файлов внутри директорий, которые начинаются на *h* и  содержать ещё один символ после. Например */images/h4/user.jpg*, */images/h/company.jpeg*

```bash
/images/h?/*.jp?g
```

Игнорировать временные файлы в Mac OS, которые создаются в каждой папке для отслеживания

```bash
.DS_Store
```

## Игнориование файлов глобально

Если вы обнаружили что вам нужно игнорировать одни и те же файлы от проекта к проекту, тогда можно настроить и это будет означать что мы будем игнорировать указанные файлы во всех репозиториях, а не в каком-то конкретном. Это будет частью конфигурации Git, а это означает что эта информация не будет сохранятся в репозитории. Соответственно другие учасники проекта не будут видить эти настройки, поэтому важно настраивать данную конфигурации только с учётом использования определённого компьютера или операционных систем.

Это реализуется с помощью команды `git config` и нужно указать путь по которую будет доступен файл для глобального игнорирования. Его можно назвать как угодно, но лучше называть так чтобы было понятно что хранится внутри.

* Создадим файл *.gitignore_global` и откроем его с помощью редактора Vim

```bash
cd ~
touch .gitignore_global
vim .gitignore_global
```

* Укажем что мы будем игнорировать системные файлы Mac OS, которые она использует для своего отслеживания

```bash
.DS_Store
.Trashes
.Spotlight-V100
```

* Укажем путь к этому файлу в конфигурации Git - лучше прописывать полный путь, в моём случае это

```bash
git config --global core.excludesfile c:/Users/Vladimir/.gitignore_global
```

* Проверим записались ли данные в файл конфигурации

```bash
cat ~/.git
```

## Игнорирование отслеживаемых файлов

Это те файлы, которые мы уже начали отслеживать и теперь хотим их игнорировать. Git не будет игнорировать файл, который уже отслеживался до того, как правило было добавленно в правило *.gitignore*. Нам нужно сказать Git чтобы он перестал отслеживать файл, который мы хотим игнорировать и один из способов это сделать - просто удалить его с помощью команды `git rm` c опцией `--cached`, которая укажет удалить данный файл из буфера, а не из репозитория и это приведёт к тому что файлы больше не будут отслеживатся, копия просто будет оставатся в репозитории и копия будет в рабочей директории, её не будет только в буфере.

* Создадим тестовый файл
* Добавим его в слежку и закомитим
* Добавим файл *.gitignore* и укажем что мы хотим игнорировать файл *test.txt*
* Добавим файл *.gitignore* в слежку и закомитим его
* Изменяем файл *test.txt*, проверяем статус и видим что он до сих пор не игнорируется
* Удаляем файл *test.txt* из буфера
* Коммитим изменения
* Делаем правки в файле *test.txt*, проверяем статус и видим что теперь файл игнорируется

```bash
git add test.txt
git commit -m "Add temp file"
git status
git add .
git commit -m "Add .gitignore file"
git status
git rm --cached test.txt
git commit -m "Remove test.txt from staging area"
```

## Добавление в слежку пустых директорий

Git игнорирует папки в которых нет файлов, но если в этот папке появляется файл, то Git тут же начинает отслеживать данную папку. Трюк, который позволит нам отслеживать пустую директорию заключается в том чтобы вставить в данную директорию пустой файл, например *.gitkeep*. Чтобы очень быстро это сделать в Unix можно использовать команду `touch`.

* Добавляем новую папку в проект, проверяем статус и видим что никаких изменений в репозитории мы пока что не видим
* Добавляем пустой файл *.gitkeep*, проверяем статус и видим что теперь в рабочей директории появилась новая папка
* Добавляем наш файл в буфер и коммитим изменения

```bash
touch test/.gitkeep
git status
git add .
git status
git commit -m "Add empty folder with .gitkeep file"
```