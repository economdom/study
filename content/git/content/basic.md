# Основы работы с Git

## Инициализация репозитория

Работа с Git начинается с создания локального репозитория. Это можно сделать двумя способами:

* Создать новый/пустой репозиторий
* Клонировав/импортируете уже существующий с удалённого (Git, BitBucket)

Клонирование удалённого репозитория будет рассмотренно далее в разделе о GitHub.

Новый репозиторий можно создать в директории, где уже имеются какие-то файлы проекта, потом их нужно будет добавить в отслеживание/версионный контроль и закомитить изменения. Закомитить - означает создать снимок состояния проиндексированных файлов в рабочей директории.

Процес работы в Git очень прост и в большинстве случаев сводится к 3 основным действиям:

* Делаете изменения - добавляете, удаляете, редактируете файлы
* Добавляете изменения - отслеживание в Git
* Фиксируете изменения в хранилище - делаете коммит

Это далеко не всё что вы будете делать, но это базовые действия, которые вы будете выполнять чаще всего.

На практике это выглядит так:

* Инициализируем/создаём пустой репозиторий. Это позволит Git начать слежку за проектом
* Проверяем статус - покажет изменнённые файлы (будут подсвеченные красным)
* Добавляем новые файлы для последующего комита. Для того чтобы добавить все файлы в слежку можно использовать флаг `--all`, `-a` или `.`. Это все флаги синонимы.
* Коммитим изменения + добавляем сообщение
* Показать логи коммитов
* Горячая клавиша используемая для выхода и истории логов
* Закомитить все изменения

```bash
git init
git status
git add .
git commit -m "Init repo"
git log
q
git commit -a
```

Создание репозитория в указанном каталоге

```bash
$ git init <directory>
```

После чего откроется окно редактора по умолчанию и у вас есть возможность подкорректировать сообщение или оставить всё как есть и записать изменения и выйти. В моём случае у меня запускается Vim в коммандном режиме и мне нужно использовать такую конструкцию `:wq` для того чтобы сохраниться и закрыть редактор.

## Проверка статуса

Перед коммитом всегда проверяйте статус. Команда `git status` сообщает нам о том какие различия есть между нашей рабочей директорией, буфером (область подготовленных файлов) и Git репозиторием.

```bash
git status
git add .
```

* `git status` позволяет отслеживать в каком состоянии на данный момент находятся файлы проекта
* `On branch master` - говорить о том что на данный момент мы находимся в ветке `master` (основной ветке по умолчанию). О ветках будет отдельный раздел.
* `Untracked files` - список неотслеживаемых файлов
* `git add .` - добавит все файлы в слежку. Команду `git add` нужно выполнять каждый раз после того как были внесенны изменения в определенный файл для того чтобы данный файл был проиндексированный и мы могли зафиксировать его последние изменения с помощью коммита
* `Changes to be commited` - список подготовленных файлов, состояние которых уже можно закомитить

```bash
git status -s
```

Выведет более короткий вывод статуса

## Добавление файлов в слежку

Если после проверки статуса мы получаем сообщение о том что у нас есть неотслеживаемые файлы.

* Инициализируем новый репозиторий
* Создадим два файла
* Добавляем в буфер один файл
* Проверяем статус

```bash
git init
touch first.html second.html
git status
```

После того как мы проверим статус мы увидим два разных раздела:

* Буферная зона, где указанно что изменения могут быть закомичены. Только те файлы, которые добавленны в буферную зону могут быть закомичены. Также у нас отображается команда, которую можно использовать для того чтобы вывести файл из буферной зоны (`git reset HEAD <file>`)
* Неотслеживаемые файлы - они до сих пор находятся в рабочей директории

Чтобы добавить в буфер только те файлы, которые находятся в определённой папке нужно использовать следующую запись

```bash
git add folder_name/*
```


## Фиксация изменений (коммит)

Комитятся только те файлы, которые находятся в буфере. Тоесть для того чтобы закомитись все файлы их нужно все добавить в буфер и только тогда мы закомитим все изменённые файлы проекта.

Каждый коммит должен нести смысловую нагрузку, поэтому нужно добавлять в буфер и коммитить только те изменнёные файлы, которые будут относится к какому-то определённому контексту изменений.

```bash
git add .
git commit -m "Add new files to projects"
```

Альтернативный вариант коммита, позволяет автоматически добавить все файлы в буфер и закомитить их.

```bash
git commit -am "Some test message"
```

Недостатки такого подхода заключаются в том что будут добавлятся все без исключения файлы, которые были модифицированны. Плюс, файлы которые не отслеживаются и файлы которые были удаленны не включаются в коммит. Эта команда хорошо подходит для модификаций, но для новых и удалённых файлов она не работает.

Можно добавить изменения из буфера к последнему коммиту без добавления нового коммита с помощью флага `--amend`.

```bash
git commit --amend
```

Чтобы включить в комментарий к коммиту информацию о том какие именно были сделаны изменения в каких файлах надо дать команду

```bash
git commit -v
```

## Редактирование файлов

После внесения изменений и после вызова команды `git status` мы увидим что у нас есть модифицированные файлы и что они пока что не добавленны в буфер. Нужно добавить их в буфер и лишь потом можно будет закомитить изменения в этих файлах. Фактически с изменёнными/модифицированные файлами мы поступаем точно также как и с новыми файлами, тоесть их, после редактирования, нужно каждый раз заново добавлять в буфер.

## Просмотр изменений

Изучим как просматривать сделанные изменения в файлах, перед тем как делать коммит. В мире Unix часто используют команду `diff` чтобы сравнить два файла и в Git используется такая же команда для того чтобы показать разницу между старой версией и новой версией. Таким образом он сравнивает два файла - тот который находится в репозитории и изменённый который находится в рабочей директории. `diff` н покажет нам целый документ - он отобразит только тот фрагмент файла, который был изменён, тоесть те строки которые были добавленны и те которые были удаленны. Git нам покажет номера строк в которых произошли изменения.

Если нас интересуют только те изменения, которые были сделанны в отдельном файле, то нам нужно его передать команде `diff`

```bash
git diff
git diff index.html
```

Если отображаются длинные строки и часть их не видно, тогда можно использовать комбинацию <kbd>-</kbd>, <kbd>Shift</kbd> + <kbd>S</kbd> - таким образом строки будут помещены в область просмотра, вместо того чтобы быть обрезанными (toggle fold long lines). Это настраивается в конфигурационном файле.

Есть также другой формат вывода изменений, для этого нужно использовать флаг `--color-worlds`, таким образом изменения будут размещатся не на разных строках, а будут размещатся рядом.

## Просмотр изменений, которые находятся в областе подготовленных файлов

Для этих целей также используется команда `git diff` но тут уже нам нужно передать специальный флаг `--staged`

```bash
git diff --staged
```

## Удаление закомиченных файлов

Можно сначала файл удалить и файловой системы, затем использовать команду `git rm <file>`, куда нам нужно передать имя удаляемого файла. Проверяем статус и можем комитить изменения.

```bash
git rm second.html
git status
```

Есть другой способ - можно просто использовать команду удаления в Git при этом файл из файловой системы будет удалён автоматически.

## Перемещение и переименование файлов

Как и из процессом удаления, у нас есть два возможных варианта - с предварительным удалением файла из файловой системы и простым удалением файла из Git, минуя первый этап. Если мы переименовуем файл, то Git этого не определяет, он воспринимает это как удаление существующего файла и добавление нового файла в рабочую директорию как неотслуживаемый файл.

После того как мы добавим новый файл в буфер и удалим тот который переименовали, Git сравниваем содержимое, и после проверки статуса может сообщит нам о том, что Git всё таки обнаружил что данный файл все таки был переименован. Таким образом, как только переименованый файл попадает в буфер, Git сравнивает содержимое между двумя файлами, при этом содержимое файлов не объязательно должно быть точно идентичным друг другу.

```bash
git add new.html
git rm first.html
git status
```

Переименование и перемещение являются одинаковыми вещами в Git (подобно Unix).

```bash
git mv new.html new_second.html
git status
```

Как мы видим удаление/перемещение/переименование проще делать сразу через Git, но это удобно делать если вы выполняете эти команды для одного файла, с несколькими файлами проще все таки выполнять подобные операции в файловой системе, затем использовать Git. Процес перемещение файла в другую папку при этом ничем не изменяется - нужно лишь указать правильный путь к папке и название файла.

```bash
git mv new_second.html new/new_second.html
```

По существу это удаление файла из отслеживаемых. Если файл уже был до этого закоммичен в Git, то из старых коммитов его по прежнему можно будет достать.